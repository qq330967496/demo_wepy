"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _event=require("./event.js"),_event2=_interopRequireDefault(_event),PREFIX="$",JOIN="$",prefixList={},comCount=0,$getPrefix=function(e){return e},pageEvent=["onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage"],$bindEvt=function e(t,n,o){n.$prefix=$getPrefix(o),Object.getOwnPropertyNames(n.components||{}).forEach(function(a){var r=n.components[a],i=new r;i.initMixins(),i.$name=a;var p=o?o+i.$name+"$":"$"+i.$name+"$";$getPrefix(p),n.$com[a]=i,e(t,i,p)}),Object.getOwnPropertyNames(n.constructor.prototype||[]).forEach(function(e){"constructor"!==e&&-1===pageEvent.indexOf(e)&&(t[e]=function(){n.constructor.prototype[e].apply(n,arguments),n.$apply()})});var a=Object.getOwnPropertyNames(n.methods||[]);return n.$mixins.forEach(function(e){a=a.concat(Object.getOwnPropertyNames(e.methods||[]))}),a.forEach(function(e,o){t[n.$prefix+e]=function(t){for(var o=arguments.length,a=Array(o>1?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];var i=new _event2.default("system",this,t.type);i.$transfor(t);var p=[],c=0,s=void 0,f=void 0,u=void 0;if(t.currentTarget&&t.currentTarget.dataset){for(s=t.currentTarget.dataset;void 0!==s["wepyParams"+(f=String.fromCharCode(65+c++))];)p.push(s["wepyParams"+f]);void 0!==s.comIndex&&(u=s.comIndex)}if(void 0!==u){u=(""+u).split("-");for(var h=u.length,$=h;h-- >0;){$=h;for(var d=n;$-- >0;)d=d.$parent;d.$setIndex(u.shift())}}a=a.concat(p);var l=void 0,v=void 0,y=n.methods[e];return y&&(l=y.apply(n,a.concat(i))),n.$mixins.forEach(function(t){t.methods[e]&&(v=t.methods[e].apply(n,a.concat(i)))}),n.$apply(),y?l:v}}),t};exports.default={$createApp:function(e){var t={},n=new e;return this.$instance||(n.init(this),this.$instance=n),Object.getOwnPropertyNames(n.constructor.prototype).forEach(function(e){"constructor"!==e&&(t[e]=n.constructor.prototype[e])}),t.$app=n,n.$wxapp=getApp(),t},$createPage:function(e,t){var n=this,o={},a=new e;return t&&(this.$instance.$pages[t]=a),a.initMixins(),o.$page=a,o.onLoad=function(){for(var t=arguments.length,o=Array(t),r=0;r<t;r++)o[r]=arguments[r];a.$name=e.name||"unnamed",a.init(this,n.$instance,n.$instance);var i=n.$instance.__prevPage__,p={};p.from=i||void 0,i&&Object.keys(i.$preloadData).length>0&&(p.preload=i.$preloadData,i.$preloadData={}),a.$prefetchData&&Object.keys(a.$prefetchData).length>0&&(p.prefetch=a.$prefetchData,a.$prefetchData={}),o.push(p),a.onLoad&&a.onLoad.apply(a,o),a.$mixins.forEach(function(e){e.onLoad&&e.onLoad.apply(a,o)}),a.$apply()},o.onShow=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n.$instance.__prevPage__=a,a.onShow&&a.onShow.apply(a,t),a.$mixins.forEach(function(e){e.onShow&&e.onShow.apply(a,t)});var r=getCurrentPages(),i=r[r.length-1].__route__;n.$instance.__route__!==i&&(n.$instance.__route__=i,a.onRoute&&a.onRoute.apply(a,t),a.$mixins.forEach(function(e){e.onRoute&&e.onRoute.apply(a,t)})),a.$apply()},pageEvent.forEach(function(e){"onLoad"!==e&&"onShow"!==e&&(o[e]=function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var r=void 0;return a[e]&&(r=a[e].apply(a,n)),"onShareAppMessage"===e?r:(a.$mixins.forEach(function(t){t[e]&&t[e].apply(a,n)}),a.$apply(),r)})}),a.onShareAppMessage||delete o.onShareAppMessage,$bindEvt(o,a,"")}};