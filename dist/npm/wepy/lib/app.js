"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_native=require("./native.js"),_native2=_interopRequireDefault(_native),RequestMQ={map:{},mq:[],running:[],MAX_REQUEST:5,push:function(e){for(e.t=+new Date;this.mq.indexOf(e.t)>-1||this.running.indexOf(e.t)>-1;)e.t+=10*Math.random()>>0;this.mq.push(e.t),this.map[e.t]=e},next:function(){var e=this;if(0!==this.mq.length&&this.running.length<this.MAX_REQUEST-1){var t=this.mq.shift(),n=this.map[t],i=n.complete;return n.complete=function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];e.running.splice(e.running.indexOf(n.t),1),delete e.map[n.t],i&&i.apply(n,r),e.next()},this.running.push(n.t),wx.request(n)}},request:function(e){return e=e||{},e="string"==typeof e?{url:e}:e,this.push(e),this.next()}},_class=function(){function e(){_classCallCheck(this,e),this.$addons={},this.$interceptors={},this.$pages={}}return _createClass(e,[{key:"init",value:function(e){this.initAPI(e),this.$wxapp=getApp()}},{key:"use",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];"string"==typeof e&&this[e]?(this.$addons[e]=1,this[e](n)):this.$addons[e.name]=new e(n)}},{key:"intercept",value:function(e,t){this.$interceptors[e]=t}},{key:"promisify",value:function(){}},{key:"requestfix",value:function(){}},{key:"initAPI",value:function(e){var t=this,n={stopRecord:!0,pauseVoice:!0,stopVoice:!0,pauseBackgroundAudio:!0,stopBackgroundAudio:!0,showNavigationBarLoading:!0,hideNavigationBarLoading:!0,createAnimation:!0,createContext:!0,createCanvasContext:!0,hideKeyboard:!0,stopPullDownRefresh:!0};Object.keys(wx).forEach(function(i){n[i]||"on"===i.substr(0,2)||/\w+Sync$/.test(i)?(Object.defineProperty(_native2.default,i,{get:function(){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return wx[i].apply(wx,t)}}}),e[i]=_native2.default[i]):(Object.defineProperty(_native2.default,i,{get:function(){return function(e){if(e=e||{},t.$interceptors[i]&&t.$interceptors[i].config){var n=t.$interceptors[i].config.call(t,e);if(!1===n)return t.$addons.promisify?Promise.reject("aborted by interceptor"):void(e.fail&&e.fail("aborted by interceptor"));e=n}if("request"===i&&(e="string"==typeof e?{url:e}:e),t.$addons.promisify)return new Promise(function(n,r){var s={};["fail","success","complete"].forEach(function(o){s[o]=e[o],e[o]=function(e){t.$interceptors[i]&&t.$interceptors[i][o]&&(e=t.$interceptors[i][o].call(t,e)),"success"===o?n(e):"fail"===o&&r(e)}}),t.$addons.requestfix&&"request"===i?RequestMQ.request(e):wx[i](e)});var r={};["fail","success","complete"].forEach(function(n){r[n]=e[n],e[n]=function(e){t.$interceptors[i]&&t.$interceptors[i][n]&&(e=t.$interceptors[i][n].call(t,e)),r[n]&&r[n].call(t,e)}}),t.$addons.requestfix&&"request"===i?RequestMQ.request(e):wx[i](e)}}}),e[i]=_native2.default[i])})}}]),e}();exports.default=_class;