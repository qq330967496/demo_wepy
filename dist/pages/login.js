"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_utils=require("./../lib/utils.js"),_utils2=_interopRequireDefault(_utils),utils=void 0,Login=function(e){function t(){var e,o,n,i;_classCallCheck(this,t);for(var a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];return o=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.config={},n.components={},n.data={phone:"",idCode:"",isGetIdCode:!0,idCodeTime:0},n.computed={},n.methods={bindPhone:function(e){n.phone=e.detail.value},bindIdCode:function(e){n.idCode=e.detail.value},getIdCode:function(){var e=n;console.log("获取验证码"),wx.showLoading({title:"获取验证码中",mask:!0}),_wepy2.default.request({url:"https://peccancy"+utils.getPrefix()+".etcchebao.com/v1/home/sms",data:{phone:e.phone,channelId:utils.getChannelId()},complete:function(){},success:function(t){var o=t.data;if(console.log("获取验证码",o),0==o.code){wx.showToast({icon:"success",title:"已成功发送验证码"}),_wepy2.default.setStorage({key:"phone",data:e.phone}),e.isGetIdCode=!1,e.idCodeTime=60,e.$apply();var n=setInterval(function(){e.idCodeTime--,e.idCodeTime<1&&(e.isGetIdCode=!0,clearInterval(n)),e.$apply()},1e3)}else wx.hideLoading(),_wepy2.default.showModal({title:"错误",content:o.msg,showCancel:!1})},fail:function(){wx.hideLoading(),_wepy2.default.showModal({title:"错误",content:"网络错误，请重试",showCancel:!1})}})},login:function(e){console.log("登录");var t=n;return t.phone&&11==t.phone.length?t.idCode?(wx.showLoading({title:"登录中",mask:!0}),void _wepy2.default.request({url:"https://peccancy"+utils.getPrefix()+".etcchebao.com/v1/home/auth",data:{phone:t.phone,code:t.idCode,channelId:utils.getChannelId()},complete:function(){wx.hideLoading()},success:function(e){var o=e.data;console.log("登录",o),0==o.code?(_wepy2.default.setStorage({key:"token",data:o.data.token}),t.$redirect("/pages/vehicle_list")):_wepy2.default.showModal({title:"错误",content:o.msg,showCancel:!1})},fail:function(){_wepy2.default.showModal({title:"错误",content:"网络错误，请重试",showCancel:!1})}})):void _wepy2.default.showModal({title:"提示",content:"验证码不能为空",showCancel:!1}):void _wepy2.default.showModal({title:"提示",content:"请输入正确的手机号",showCancel:!1})}},n.events={},i=o,_possibleConstructorReturn(n,i)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(){var e=this;utils=new _utils2.default(this),utils.init(),_wepy2.default.getStorageSync("token")&&(wx.showLoading({title:"登录中",mask:!0}),e.$redirect("/pages/vehicle_list"));var t=_wepy2.default.getStorageSync("phone");t&&(e.phone=t)}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Login,"pages/login"));